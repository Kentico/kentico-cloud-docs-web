/**
 * Initializes lightbox and caption if available
 */
(() => {
    const initLightboxOnImages = () => {
      setTimeout(() => {
        let imgs = document.querySelectorAll('img.article__add-lightbox');

        const initLightbox = () => {
          document.querySelectorAll('img.article__add-lightbox').forEach((item) => {
            let figcaption = '';
            const nextSibling = item.nextSibling;
            const nextNextSibling = nextSibling.nextSibling;

            // Find caption in DOM generated by Kentico Kontent
            const captionElem = (() => {
              if (nextSibling && nextSibling.tagName === 'FIGCAPTION') {
                return nextSibling;
              } else if (nextNextSibling && nextNextSibling.tagName === 'FIGCAPTION') {
                return nextNextSibling;
              } else {
                return null;
              }
            })();

            if (captionElem !== null) {
              figcaption = `<div class="basicLightbox__description">${captionElem.innerHTML}</div>`;
            }

            // Init lighbox with caption
            item.addEventListener('click', () => {
              window.basicLightbox.create(`<img src="${item.getAttribute('src').split('?')[0] + '?w=1600&fm=jpg&auto=format'}">${figcaption}`).show();
            });
          });
        }

        const interval = setInterval(() => {
          imgs = document.querySelectorAll('img.article__add-lightbox');

          if (imgs.length) {
            initLightbox();
            clearInterval(interval);
          }
        }, 100);
      }, 0);
    };

    const initLightboxOnEmbeds = () => {
      setTimeout(() => {
        let elems = document.querySelectorAll('[data-lightbox]');

        const initLightbox = () => {
          document.querySelectorAll('[data-lightbox]').forEach((item) => {
            // Init lighbox with caption
            item.addEventListener('click', (e) => {
              e.preventDefault();
              const itemToZoom = document.querySelector(`#${item.getAttribute('data-lightbox')}`);
              console.log(itemToZoom.innerHTML);
              if (itemToZoom) {
                window.basicLightbox.create(itemToZoom.innerHTML).show();
              }
            });
          });
        }

        const interval = setInterval(() => {
          elems = document.querySelectorAll('[data-lightbox]');

          if (elems.length) {
            initLightbox();
            clearInterval(interval);
          }
        }, 100);
      }, 0);
    };

    initLightboxOnImages();
    initLightboxOnEmbeds();
  })();
